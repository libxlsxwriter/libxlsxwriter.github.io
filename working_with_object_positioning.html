<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>libxlsxwriter: Working with Object Positioning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libxlsxwriter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Contents</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Working with Object Positioning </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Libxlsxwriter positions worksheet objects such as images and charts in worksheets by calculating precise co-ordinates based on the object size, it's DPI (for images) and any scaling that the user specifies. It also takes into account the heights and widths of the rows and columns that the object crosses. In this way objects maintain their original sizes even if the rows or columns underneath change size or are hidden.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;xlsxwriter.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structlxw__workbook.html">lxw_workbook</a>  *workbook  = <a class="code" href="workbook_8h.html#a1cf96608a23ee4eb0e8467c15240d00b">workbook_new</a>(<span class="stringliteral">&quot;images.xlsx&quot;</span>);</div>
<div class="line">    <a class="code" href="structlxw__worksheet.html">lxw_worksheet</a> *worksheet = <a class="code" href="workbook_8h.html#a81d456b4f65a464e78e4a0030ecc3c2e">workbook_add_worksheet</a>(workbook, NULL);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Original image.</span></div>
<div class="line">    <a class="code" href="worksheet_8h.html#a4529d77bcefcf478b8209f46fe730f6f">worksheet_insert_image</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;B2&quot;</span>), <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Same as original, despite row/col changes.</span></div>
<div class="line">    <a class="code" href="worksheet_8h.html#a4529d77bcefcf478b8209f46fe730f6f">worksheet_insert_image</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;E8&quot;</span>), <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Make column F narrower.</span></div>
<div class="line">    <a class="code" href="worksheet_8h.html#a9656e4e05d3787eee6b3e4d8e82d9b7f">worksheet_set_column</a>(worksheet, <a class="code" href="utility_8h.html#a189672bfa9c380a28d8db8c40de17fe8">COLS</a>(<span class="stringliteral">&quot;F:F&quot;</span>), 2, NULL);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Hide row 12 (zero indexed).</span></div>
<div class="line">    <a class="code" href="structlxw__row__col__options.html">lxw_row_col_options</a> row_options = {.<a class="code" href="structlxw__row__col__options.html#a0e46063d954292f4018ecb91621b7562">hidden</a> = <a class="code" href="common_8h.html#a57bffaf0ff3cb4e9f4f7f2b0b6dad349a7850bcc34c18efe2e45372f4069be0bf">LXW_TRUE</a>};</div>
<div class="line">    <a class="code" href="worksheet_8h.html#abbc2de45e0aa84341fb10a98778b3807">worksheet_set_row_opt</a>(worksheet, 11, <a class="code" href="worksheet_8h.html#a8901b9706d1c48c28c97e95b452a927a">LXW_DEF_ROW_HEIGHT</a>, NULL, &amp;row_options);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="workbook_8h.html#ad9e7aeebc0fd43562db5bcd527b2ee5e">workbook_close</a>(workbook);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="object_position1.png" alt="object_position1.png"/>
</div>
<p>As can be seen the inserted images are the same size even though the second image crosses changed rows and columns.</p>
<p>However, there are two cases where the image scale may change with row or columns changes. These are explained in the next two sections.</p>
<h1><a class="anchor" id="ww_object_position_scaling"></a>
Object scaling due to automatic row height adjustment</h1>
<p>The scaling of a image may be affected if is crosses a row that has its default height changed due to a font that is larger than the default font size or that has text wrapping turned on. In these cases Excel will automatically calculate a row height based on the text when it loads the file. Since this row height isn't available to Libxlsxwriter when it creates the file the object may appear as if it is sized incorrectly. For example::</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;xlsxwriter.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structlxw__workbook.html">lxw_workbook</a>  *workbook  = <a class="code" href="workbook_8h.html#a1cf96608a23ee4eb0e8467c15240d00b">workbook_new</a>(<span class="stringliteral">&quot;images.xlsx&quot;</span>);</div>
<div class="line">    <a class="code" href="structlxw__worksheet.html">lxw_worksheet</a> *worksheet = <a class="code" href="workbook_8h.html#a81d456b4f65a464e78e4a0030ecc3c2e">workbook_add_worksheet</a>(workbook, NULL);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structlxw__format.html">lxw_format</a> *wrap = <a class="code" href="workbook_8h.html#a279a5d7075d09a3931aae9782afede33">workbook_add_format</a>(workbook);</div>
<div class="line">    <a class="code" href="format_8h.html#a56d55dd9257d8f0645c62b296d2c196d">format_set_text_wrap</a>(wrap);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="worksheet_8h.html#ac208046e7a6d12cc87982422efa41b31">worksheet_write_string</a>(worksheet,  <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;A10&quot;</span>), <span class="stringliteral">&quot;Some text that wraps&quot;</span>, wrap);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="worksheet_8h.html#a4529d77bcefcf478b8209f46fe730f6f">worksheet_insert_image</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;B1&quot;</span>),  <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line">    <a class="code" href="worksheet_8h.html#a4529d77bcefcf478b8209f46fe730f6f">worksheet_insert_image</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;B10&quot;</span>), <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="workbook_8h.html#ad9e7aeebc0fd43562db5bcd527b2ee5e">workbook_close</a>(workbook);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="object_position2.png" alt="object_position2.png"/>
</div>
<p>As can be seen the second inserted image is distorted, compared to the first, due to the row being scaled automatically. To avoid this you should explicitly set the height of the row using <code><a class="el" href="worksheet_8h.html#ab9b7fb95e1bd9b0da70befd0d37a9173" title="Set the properties for a row of cells. ">worksheet_set_row()</a></code> if it crosses an inserted object.</p>
<h1><a class="anchor" id="ww_object_position_options"></a>
Object Positioning with Cell Moving and Sizing</h1>
<p>Excel supports three options for "Object Positioning" within a worksheet:</p>
<div class="image">
<img src="object_position3.png" alt="object_position3.png"/>
</div>
<p>Image and chart objects in Libxlsxwriter emulate these options using the <code>object_position</code> parameter in <a class="el" href="structlxw__image__options.html" title="Options for inserted images. ">lxw_image_options</a> and <a class="el" href="structlxw__chart__options.html" title="Options for inserted charts. ">lxw_chart_options</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="structlxw__image__options.html">lxw_image_options</a> options = {.object_position = <a class="code" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81a3a7fd9f3ceaa180ddba415b8b7d80f68">LXW_OBJECT_MOVE_AND_SIZE</a>};</div>
<div class="line"><a class="code" href="worksheet_8h.html#a0b05e75e2c2a5c3452374714cdb2b79b">worksheet_insert_image_opt</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;E9&quot;</span>), <span class="stringliteral">&quot;red.png&quot;</span>, &amp;options);</div>
</div><!-- fragment --><p>Where <code>object_position</code> has one of the following allowable values from <a class="el" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81">lxw_object_position</a>:</p>
<ol type="1">
<li><a class="el" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81a3a7fd9f3ceaa180ddba415b8b7d80f68">LXW_OBJECT_MOVE_AND_SIZE</a>: Move and size with cells. This is the Excel default for charts.</li>
<li><a class="el" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81ae8e56c6314407205b48e9e8085926182">LXW_OBJECT_MOVE_DONT_SIZE</a>: Move but don’t size with cells. This is the Excel default for images.</li>
<li><a class="el" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81a2ce8ef5e158013c4872d312fb6b2e1a4">LXW_OBJECT_DONT_MOVE_DONT_SIZE</a>: Don’t move or size with cells.</li>
<li><a class="el" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81a833c0825a5e212ad263a20346d972a93">LXW_OBJECT_MOVE_AND_SIZE_AFTER</a>: Same as Option 1 to "move and size with
   cells" except Libxlsxwriter applies hidden cells after the object is inserted.</li>
</ol>
<p>Option 4 appears in Excel as Option 1. However, the worksheet object is sized to take hidden rows or columns into account. This allows the user to hide an image in a cell, possibly as part of an autofilter. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;xlsxwriter.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structlxw__workbook.html">lxw_workbook</a>  *workbook  = <a class="code" href="workbook_8h.html#a1cf96608a23ee4eb0e8467c15240d00b">workbook_new</a>(<span class="stringliteral">&quot;images.xlsx&quot;</span>);</div>
<div class="line">    <a class="code" href="structlxw__worksheet.html">lxw_worksheet</a> *worksheet = <a class="code" href="workbook_8h.html#a81d456b4f65a464e78e4a0030ecc3c2e">workbook_add_worksheet</a>(workbook, NULL);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structlxw__image__options.html">lxw_image_options</a> image_options = {.<a class="code" href="structlxw__image__options.html#a3affe5a43c455cc61f8e56a0d6d742d4">object_position</a> = <a class="code" href="worksheet_8h.html#a915c52f231594642bad90422c5b2cf81a833c0825a5e212ad263a20346d972a93">LXW_OBJECT_MOVE_AND_SIZE_AFTER</a>};</div>
<div class="line"></div>
<div class="line">    <a class="code" href="worksheet_8h.html#a4529d77bcefcf478b8209f46fe730f6f">worksheet_insert_image</a>(    worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;B4&quot;</span>), <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line">    <a class="code" href="worksheet_8h.html#a0b05e75e2c2a5c3452374714cdb2b79b">worksheet_insert_image_opt</a>(worksheet, <a class="code" href="utility_8h.html#ad510ac6df573d23203374e24dba373d2">CELL</a>(<span class="stringliteral">&quot;B13&quot;</span>),  <span class="stringliteral">&quot;logo.png&quot;</span>, &amp;image_options);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Hide the rows that contain the images.</span></div>
<div class="line">    <a class="code" href="structlxw__row__col__options.html">lxw_row_col_options</a> row_options = {.<a class="code" href="structlxw__row__col__options.html#a0e46063d954292f4018ecb91621b7562">hidden</a> = <a class="code" href="common_8h.html#a57bffaf0ff3cb4e9f4f7f2b0b6dad349a7850bcc34c18efe2e45372f4069be0bf">LXW_TRUE</a>};</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row_num = 1; row_num &lt; 22; row_num++)</div>
<div class="line">        <a class="code" href="worksheet_8h.html#abbc2de45e0aa84341fb10a98778b3807">worksheet_set_row_opt</a>(worksheet, row_num, <a class="code" href="worksheet_8h.html#a8901b9706d1c48c28c97e95b452a927a">LXW_DEF_ROW_HEIGHT</a>, NULL, &amp;row_options);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="workbook_8h.html#ad9e7aeebc0fd43562db5bcd527b2ee5e">workbook_close</a>(workbook);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="object_position4.png" alt="object_position4.png"/>
</div>
<p>In this example the first inserted image is visible over the hidden rows whilst the second image is hidden with the rows. Unhiding the rows in Excel would reveal the second image.</p>
<h1><a class="anchor" id="ww_object_position_sizing"></a>
Image sizing and DPI</h1>
<p>When an image is imported into Excel the DPI (dots per inch) resolution of the image is taken into account. Excel sizes the image according to a base DPI of 96 dpi. Therefore an image with a DPI of 72 may appear slightly larger when imported into Excel while an image with a DPI of 200 may appear twice as small. Libxlsxwriter also reads the DPI of the images that the user inserts into a worksheet and stores the image dimensions in the same way that Excel does. If it cannot determine the DPI of the image it uses a default of 96.</p>
<h1><a class="anchor" id="ww_object_position_image_issues"></a>
Reporting issues with image insertion</h1>
<p>A lot of work has gone into ensuring that Libxlsxwriter inserts images into worksheets in exactly the same way that Excel does, even though the required calculations and units are arcane. There are over 80 test cases that check image insertion against files created in Excel to ensure that Libxlsxwriter's handling of images is correct.</p>
<p>As such, before reporting any issues with image handling in Libxlsxwriter please check how the same image is handled in Excel (not OpenOffice, LibreOffice or other third party applications). If you do report an issue please use the Libxlsxwriter <a href="https://github.com/jmcnamara/libxlsxwriter/issues">Issue tracker is on GitHub</a> that demonstrates the issue.</p>
<p>Next: <a class="el" href="working_with_data_validation.html">Working with Data Validation</a> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright 2014-2020 John McNamara.
Generated by <a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a>
</small></address>
</body>
</html>
